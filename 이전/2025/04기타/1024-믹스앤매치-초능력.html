<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì´ˆëŠ¥ë ¥ í…ŒìŠ¤íŠ¸</title>
<script src="https://code.jquery.com/jquery-latest.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
/* === ë‹¹ì‹  ë””ìì¸ ê·¸ëŒ€ë¡œ ìœ ì§€ === */
body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,p,table,th,td,form,fieldset,legend,textarea,input,select,textarea,button{margin:0;padding:0; -webkit-text-size-adjust:none; outline:none; word-break:keep-all; font-family: 'YeogiOttaeJalnan';}
html,body{height:100%;}
body {overflow-x:hidden; overflow-y:scroll; min-width:320px;}
fieldset,li,img{border:0;vertical-align:top;outline:none;}
ul,ol{list-style:none}
button{border:0;background-color:transparent;cursor:pointer;outline:none;}
table{border-collapse:collapse;border-spacing:0}
caption {display:none;}

@font-face {
    font-family: 'YeogiOttaeJalnan';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_four@1.2/JalnanOTF00.woff') format('woff');
    font-weight: normal;
    font-display: swap;
}

body {background:#fbfbfb;}
.wrap {max-width:1000px; margin:0 auto; padding:30px;}
.section {display:none;}
.section.active {display:block;}
.title {text-align:center; font-size:50px; margin-bottom:30px;}
.title2 {text-align:center; font-size:42px;}
.title span, .title2 span {color:#ff69bc;}
.select_wrap {text-align:center;}

.section .content {padding:50px; margin:30px 0; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,.1); border-radius:40px; text-align:center; font-size:20px;}
.section select {cursor:pointer; border-radius:18px; padding:20px 20px; font-size:20px; border:0; box-shadow:0 2px 8px rgba(0,0,0,.1);}
.section select {
    appearance: none; padding-right:50px; -webkit-appearance: none; -moz-appearance: none; background-repeat: no-repeat; background-position: right 20px center; background-size: 20px;
    background-image: url("data:image/svg+xml;utf8,<svg fill='%23000000' height='20' width='20' xmlns='http://www.w3.org/2000/svg'><path d='M5 7l5 5 5-5z'/></svg>");
}
.section select:disabled {background-color:#f5f5f5;color:#aaa;border-color:#ddd;cursor:not-allowed;
    background-image: url("data:image/svg+xml;utf8,<svg fill='%23a7a7a7' height='20' width='20' xmlns='http://www.w3.org/2000/svg'><path d='M5 7l5 5 5-5z'/></svg>");
}

.con_select {text-align:center; font-size:0;}
.con_select button {display:inline-block; vertical-align:top; width:33.33%; text-align:center; font-size:24px; padding:0 20px; margin-bottom:30px; transition:opacity .2s;}
.con_select button span {font-size:21px; line-height:30px; }
.con_select button:before {display:block; font-size:100px;}
.con_select button strong {display:block; margin:20px 0; padding:16px; background:#000; color:#fff; border-radius:12px; }

.con_select.disabled button {pointer-events:none; opacity:0.4; cursor:not-allowed;}

.con_select button:nth-child(1):before{content:'ğŸ§ ';}
.con_select button:nth-child(2):before{content:'ğŸ§½';}
.con_select button:nth-child(3):before{content:'ğŸ¤';}
.con_select button:nth-child(4):before{content:'ğŸ›ï¸';}
.con_select button:nth-child(5):before{content:'ğŸ¤–';}
.con_select button:nth-child(6):before{content:'â˜•';}
.con_select button:nth-child(7):before{content:'ğŸ±';}
.con_select button:nth-child(8):before{content:'ğŸ“„';}
.con_select button:nth-child(9):before{content:'ğŸ“Š';}

.con_select button:nth-child(1) strong {background:#ea5e8a;}
.con_select button:nth-child(2) strong {background:#ffe400;}
.con_select button:nth-child(3) strong {background:#151515;}
.con_select button:nth-child(4) strong {background:#619ad6;}
.con_select button:nth-child(5) strong {background:#f79802;}
.con_select button:nth-child(6) strong {background:#633f19;}
.con_select button:nth-child(7) strong {background:#a80401;}
.con_select button:nth-child(8) strong {background:#5d5d5d;}
.con_select button:nth-child(9) strong {background:#36b816;}

.con_select button.on {position:relative;}
.con_select button.on span, .con_select button.on:before, .con_select button.on strong {opacity:.35;}
.con_select button.on:after {content:"ì„ íƒ"; width:150px; height:150px; line-height:150px; font-size:45px; border:18px solid #000; font-family:'YeogiOttaeJalnan'; display:block; position:absolute; left:50%; top:50%; transform:translate(-50%, -50%); text-align:center; border-radius:50%;}

.btn_end, .btn_end2, .btn_reset, .btn_next, .btn_fakefill {cursor:pointer; border-radius:30px; padding:20px 40px; font-size:30px; border:0; box-shadow:0 2px 8px rgba(0,0,0,.1); color:#fff; font-family:'YeogiOttaeJalnan'; display:block; margin:20px auto;}
.btn_end {background:#ff69bc; opacity:0.5; pointer-events:none;}
.btn_end.active {opacity:1; pointer-events:auto;}
.btn_end2 {background:#00a718; display:none;}
.btn_reset, .btn_fakefill {background:#888;}
.btn_next {background:#0095ff; display:none;}
.img {display:block; margin:0 auto 30px auto; height:400px;}
</style>
</head>
<body>
<div class="wrap">
    <button class="btn_fakefill">(í…ŒìŠ¤íŠ¸ìš©) ì§ì› ì„ì˜ ì°¸ì—¬ </button>
    <button class="btn_reset">(í…ŒìŠ¤íŠ¸ìš©) ë°ì´í„° ì´ˆê¸°í™” </button>

    <div id="step1" class="section active"> 
        <h2 class="title">ë‚˜ë¥¼ ìœ„í•œ <span>ì´ˆëŠ¥ë ¥ 5ê°€ì§€</span>ë¥¼ ê³ ë¥¸ë‹¤ë©´?</h2>   
        <div class="select_wrap">
            <select id="team"><option value="">ë¶€ì„œëª…</option></select>
            <select id="name" disabled><option value="">ì´ë¦„</option></select>
        </div> 
        <div class="content">
            <div class="con_select disabled">
                <button type="button"><strong>ì§€ê° ë¬´íš¨í™”</strong><span>ì§€ê°í•œ ì‚¬ì‹¤ì„ ëª¨ë‘ì˜ ê¸°ì–µ ì†ì—ì„œ ê¹¨ë—í•˜ê²Œ ì‚­ì œ</span></button>
                <button type="button"><strong>ì‹¤ìˆ˜ ë¦¬ë¬´ë²„</strong><span>ëŒ€í˜•ì‚¬ê³ ë¥¼ ì³ë„ ì‹¤ìˆ˜ë¥¼ ì§€ì›Œë²„ë¦¼</span></button>
                <button type="button"><strong>ë…¼ë¦¬ ë§ˆì´í¬</strong><span>ì•„ë¬´ë§ì´ë‚˜ ë±‰ì–´ë„ ë…¼ë¦¬ì •ì—°í•œ ì•„ì´ë””ì–´ë¡œ ë³€ì‹ </span></button>
                <button type="button"><strong>ê¿€ì  ë§í† </strong><span>ì¡¸ë¦´ ë•Œ ë§í† ë¥¼ ë®ìœ¼ë©´ ì•„ë¬´ë„ ìëŠ”ì§€ ëª¨ë¦„</span></button>
                <button type="button"><strong>ì¶œê·¼ ëŒ€ì‹ ë´‡</strong><span>ì¶œê·¼í•˜ê¸° ê·€ì°®ì•„ì§€ë©´ ë‚˜ë‘ ë˜‘ê°™ì€ ë¡œë´‡ì´ ëŒ€ì‹  ì¶œê·¼</span></button>
                <button type="button"><strong>ì»¤í”¼ í™”ìˆ˜ë¶„</strong><span>ì»µì„ ì¡ê¸°ë§Œ í•˜ë©´ ì›í•˜ëŠ” ì»¤í”¼ê°€ ë¿…</span></button>
                <button type="button"><strong>ì ì‹¬ ëšë”±ì´</strong><span>ë¨¹ê³ ì‹¶ì€ ì ì‹¬ ë©”ë‰´ë¥¼ ë§í•˜ë©´ ìŒì‹ì´ ëˆˆì•ì— ëšë”± ë“±ì¥</span></button>
                <button type="button"><strong>ê³„ì•½ í”„ë¦¬íŒ¨ìŠ¤</strong><span>ì–´ë ¤ìš´ ê³„ì•½ë„ ëª¨ë‘ ì„±ì‚¬</span></button>
                <button type="button"><strong>ë³´ê³ ì„œ ë§ˆìŠ¤í„°</strong><span>ì–´ë ¤ìš´ ë³´ê³ ì„œë„ 10ë…„ì°¨ê°™ì´ ê¹”ë” ì •í™•í•˜ê²Œ ì •ë¦¬</span></button>
            </div>
        </div>
        <button type="button" class="btn_end">ì´ˆëŠ¥ë ¥ ì„ íƒ ì™„ë£Œ</button>
    </div>

    <div id="step2" class="section">
        <div class="content">
            <img src="https://img.shoppingntmall.com/htmleditor/983/11761123283323.png" class="img">
            <h3 class="title2">ë‚˜ì™€ ë¹„ìŠ·í•œ ì´ˆëŠ¥ë ¥ì„ ì„ íƒí•œ ì‚¬ëŒì€ ëˆ„êµ´ì§€!<br>ì¶”í›„ <span>ì¡° í¸ì„± ê²°ê³¼</span>ì—ì„œ í™•ì¸í•˜ì„¸ìš”!</h3>  
        </div>
        <button type="button" class="btn_next">ë‹¤ìŒ ì‚¬ëŒ í…ŒìŠ¤íŠ¸í•˜ê¸°</button>
        <button type="button" class="btn_end2">ì¡° í¸ì„± ê²°ê³¼ ë‹¤ìš´ë¡œë“œ</button>
    </div>
</div>

<script>
$(function(){
  const validEntries = [
    {team:'ê²½ì˜ê¸°íšíŒ€', name:'ê¶Œìš©ë¯¼'},{team:'ê²½ì˜ê¸°íšíŒ€', name:'ì´ì‹œí˜„'},{team:'ê²½ì˜ê¸°íšíŒ€', name:'ì„œì˜ì„'},{team:'ê²½ì˜ê¸°íšíŒ€', name:'ì´ì„¸ì§„'},
    {team:'ì¸ì‚¬íŒ€', name:'ë‚¨ê·¼ìš°'},{team:'ì¸ì‚¬íŒ€', name:'ìµœìš©ìµ'},{team:'ì¸ì‚¬íŒ€', name:'ì •ìˆ˜ë¹ˆ'},{team:'ì¸ì‚¬íŒ€', name:'ê³½ì€ë¹„'},
    {team:'ì¬ë¬´íŒ€', name:'ë°±ê´€ë£¡'},{team:'ì¬ë¬´íŒ€', name:'ê¹€ì§€ì„ '},{team:'ì¬ë¬´íŒ€', name:'ì¡°ê²½ì¼'},{team:'ì¬ë¬´íŒ€', name:'ì´ì² ìˆ˜'},{team:'ì¬ë¬´íŒ€', name:'ë°•í•˜ì›'},
    {team:'ìƒìƒí˜‘ë ¥íŒ€', name:'ì–‘ìš°ì¼'},{team:'ìƒìƒí˜‘ë ¥íŒ€', name:'ì´í˜•ë¥ '},{team:'ìƒìƒí˜‘ë ¥íŒ€', name:'ìµœìœ¤ì„'},{team:'ìƒìƒí˜‘ë ¥íŒ€', name:'ê¹€ì—°ì£¼'},{team:'ìƒìƒí˜‘ë ¥íŒ€', name:'ë°•ìœ ì •'},{team:'ìƒìƒí˜‘ë ¥íŒ€', name:'ê¹€ë ¤ì›'},{team:'ìƒìƒí˜‘ë ¥íŒ€', name:'ì´í˜„ë²”'},
    {team:'ê³ ê°ì„œë¹„ìŠ¤íŒ€', name:'ì¥ìš°ì„'},{team:'ê³ ê°ì„œë¹„ìŠ¤íŒ€', name:'ì˜¤í™ì„'},{team:'ê³ ê°ì„œë¹„ìŠ¤íŒ€', name:'ì§€ê²½ì„'},{team:'ê³ ê°ì„œë¹„ìŠ¤íŒ€', name:'ë§ˆì€ì˜'},{team:'ê³ ê°ì„œë¹„ìŠ¤íŒ€', name:'ì„œêµì˜'},{team:'ê³ ê°ì„œë¹„ìŠ¤íŒ€', name:'ë°•ì°¬í›„'},{team:'ê³ ê°ì„œë¹„ìŠ¤íŒ€', name:'ì†¡ìˆ˜ë¯¼'},{team:'ê³ ê°ì„œë¹„ìŠ¤íŒ€', name:'í™©ì§€ì˜ˆ'},
    {team:'ì˜ì—…ê¸°íšíŒ€', name:'ê¹€íƒë´‰'},{team:'ì˜ì—…ê¸°íšíŒ€', name:'ì´í˜„ì›…'},{team:'ì˜ì—…ê¸°íšíŒ€', name:'ê¹€ì •ì„'},{team:'ì˜ì—…ê¸°íšíŒ€', name:'ì •ì„±ì€'},{team:'ì˜ì—…ê¸°íšíŒ€', name:'ê¹€ë¯¼ê²½'},{team:'ì˜ì—…ê¸°íšíŒ€', name:'ê¹€ê°€í¬'},{team:'ì˜ì—…ê¸°íšíŒ€', name:'ë°•ìƒˆì–€'},{team:'ì˜ì—…ê¸°íšíŒ€', name:'ì‹ ì§€ìœ¤'},
    {team:'ë§ˆì¼€íŒ…íŒ€', name:'ê¹€ë³´ëŒ'},{team:'ë§ˆì¼€íŒ…íŒ€', name:'í™ë¯¸ë¼'},{team:'ë§ˆì¼€íŒ…íŒ€', name:'ì •ì•„ë¦¼'},{team:'ë§ˆì¼€íŒ…íŒ€', name:'ê¹€ì •í›ˆ'},{team:'ë§ˆì¼€íŒ…íŒ€', name:'ì •ìˆ˜í˜„'},{team:'ë§ˆì¼€íŒ…íŒ€', name:'ì„ì§€í˜œ'},{team:'ë§ˆì¼€íŒ…íŒ€', name:'ê¹€ê²½ì£¼'},{team:'ë§ˆì¼€íŒ…íŒ€', name:'ê¹€ìƒìš°'},{team:'ë§ˆì¼€íŒ…íŒ€', name:'ì¥ë¯¸ì—°'},{team:'ë§ˆì¼€íŒ…íŒ€', name:'ì¥ìŠ¬ê¸°'},{team:'ë§ˆì¼€íŒ…íŒ€', name:'ì‹¬ì§€ì—°'},{team:'ë§ˆì¼€íŒ…íŒ€', name:'ì´ì§€ì˜'},{team:'ë§ˆì¼€íŒ…íŒ€', name:'ì´ì˜ì„œ'},
    {team:'í™ë³´íŒ€', name:'ìœ ì§€ì›'},
    {team:'ì˜ìƒì œì‘íŒ€', name:'ì‹¬ë„ì§„'},{team:'ì˜ìƒì œì‘íŒ€', name:'ì¥ë¬¸ì„'},{team:'ì˜ìƒì œì‘íŒ€', name:'ìµœì˜ì€'},{team:'ì˜ìƒì œì‘íŒ€', name:'ë°•ë¯¸ì •'},{team:'ì˜ìƒì œì‘íŒ€', name:'í•œì§€ìˆ˜'},{team:'ì˜ìƒì œì‘íŒ€', name:'ì •ì†Œì—°'},{team:'ì˜ìƒì œì‘íŒ€', name:'ì´ì¤€í˜„'},{team:'ì˜ìƒì œì‘íŒ€', name:'ê¹€ë¯¼'},{team:'ì˜ìƒì œì‘íŒ€', name:'ì•ˆìˆ˜ë¹ˆ'},{team:'ì˜ìƒì œì‘íŒ€', name:'ìµœí•˜ë‚˜'},{team:'ì˜ìƒì œì‘íŒ€', name:'ë°•ë™ê·œ'},{team:'ì˜ìƒì œì‘íŒ€', name:'ì›ì¢…ì„±'},{team:'ì˜ìƒì œì‘íŒ€', name:'ì†¡ì§„ì„ '},{team:'ì˜ìƒì œì‘íŒ€', name:'ê¹€ë¯¼ê²½'},{team:'ì˜ìƒì œì‘íŒ€', name:'ê¹€ì—°ì£¼'},{team:'ì˜ìƒì œì‘íŒ€', name:'ì‹ í˜œì›'},
    {team:'ì •ë³´ê¸°íšíŒ€', name:'ì´ë™ê·œ'},{team:'ì •ë³´ê¸°íšíŒ€', name:'ì‹ í˜ì¶˜'},{team:'ì •ë³´ê¸°íšíŒ€', name:'ë°©ê¸°ì •'},{team:'ì •ë³´ê¸°íšíŒ€', name:'ë¯¼ìœ¤ê²½'},{team:'ì •ë³´ê¸°íšíŒ€', name:'ë°±ì„±í˜„'},{team:'ì •ë³´ê¸°íšíŒ€', name:'ìµœìœ¤í˜¸'},{team:'ì •ë³´ê¸°íšíŒ€', name:'ì´ìš©í˜¸'},{team:'ì •ë³´ê¸°íšíŒ€', name:'ì •ì„¸ì² '},{team:'ì •ë³´ê¸°íšíŒ€', name:'ê¹€ì°½í™˜'},
    {team:'ì„œë¹„ìŠ¤ê¸°íšíŒ€', name:'ì´ì€ì£¼'},{team:'ì„œë¹„ìŠ¤ê¸°íšíŒ€', name:'í”¼ì„¤í˜„'},{team:'ì„œë¹„ìŠ¤ê¸°íšíŒ€', name:'ìµœí˜„ê·œ'},{team:'ì„œë¹„ìŠ¤ê¸°íšíŒ€', name:'ë°°ì§€ìˆ˜'},
    {team:'íŒ¨ì…˜ì˜ë¥˜íŒ€', name:'ì‹ ì€ë¯¸'},{team:'íŒ¨ì…˜ì˜ë¥˜íŒ€', name:'ì¡°ì¸ê·œ'},{team:'íŒ¨ì…˜ì˜ë¥˜íŒ€', name:'ìœ ìœ¤ê²½'},{team:'íŒ¨ì…˜ì˜ë¥˜íŒ€', name:'ì„œì¤€í˜¸'},{team:'íŒ¨ì…˜ì˜ë¥˜íŒ€', name:'í•¨ìˆ˜ì§€'},{team:'íŒ¨ì…˜ì˜ë¥˜íŒ€', name:'í˜„ì¤€'},{team:'íŒ¨ì…˜ì˜ë¥˜íŒ€', name:'ì„ìˆ˜ì—°'},{team:'íŒ¨ì…˜ì˜ë¥˜íŒ€', name:'ë°±í•˜ì€'},
    {team:'íŒ¨ì…˜ì¡í™”íŒ€', name:'ì´ì¤€ì„'},{team:'íŒ¨ì…˜ì¡í™”íŒ€', name:'í•˜ì—°ì£¼'},{team:'íŒ¨ì…˜ì¡í™”íŒ€', name:'ì¥ê²½ë¯¸'},{team:'íŒ¨ì…˜ì¡í™”íŒ€', name:'ì‹¬ì¬ìš©'},{team:'íŒ¨ì…˜ì¡í™”íŒ€', name:'í•œë‚¨í¬'},{team:'íŒ¨ì…˜ì¡í™”íŒ€', name:'ë¬¸í˜„'},{team:'íŒ¨ì…˜ì¡í™”íŒ€', name:'ì‹ ì—°ì‹'},{team:'íŒ¨ì…˜ì¡í™”íŒ€', name:'ì •ì˜ˆì§€'},{team:'íŒ¨ì…˜ì¡í™”íŒ€', name:'ì „ë‹¤ì¸'},
    {team:'í—¬ìŠ¤ë·°í‹°íŒ€', name:'ë°±ìŠ¹ì£¼'},{team:'í—¬ìŠ¤ë·°í‹°íŒ€', name:'ì¡°í˜œê²½'},{team:'í—¬ìŠ¤ë·°í‹°íŒ€', name:'ì„±í˜œì—°'},{team:'í—¬ìŠ¤ë·°í‹°íŒ€', name:'ì´ìˆ˜í˜„'},{team:'í—¬ìŠ¤ë·°í‹°íŒ€', name:'ì´ë‹¤í˜„'},{team:'í—¬ìŠ¤ë·°í‹°íŒ€', name:'ì •ì€ì„'},{team:'í—¬ìŠ¤ë·°í‹°íŒ€', name:'ê¹€ì§„ë•'},{team:'í—¬ìŠ¤ë·°í‹°íŒ€', name:'ê¹€í¬ì„±'},
    {team:'í‘¸ë“œíŒ€', name:'ìµœë™í™˜'},{team:'í‘¸ë“œíŒ€', name:'ì–‘ì›ì„'},{team:'í‘¸ë“œíŒ€', name:'ë°•ì§€ì•„'},{team:'í‘¸ë“œíŒ€', name:'ë°•ì§€ìˆ˜'},{team:'í‘¸ë“œíŒ€', name:'ì •ììœ¤'},{team:'í‘¸ë“œíŒ€', name:'ê¹€ì†Œí˜„'},{team:'í‘¸ë“œíŒ€', name:'ì •ì˜ˆì›'},
    {team:'ë¦¬ë¹™íŒ€', name:'í™ì˜ê¸°'},{team:'ë¦¬ë¹™íŒ€', name:'ë„ì¢…ì˜¤'},{team:'ë¦¬ë¹™íŒ€', name:'ì´í˜¸'},{team:'ë¦¬ë¹™íŒ€', name:'ê¹€ì„¸ê·¼'},{team:'ë¦¬ë¹™íŒ€', name:'ê¹€ë³‘ì¤€'},{team:'ë¦¬ë¹™íŒ€', name:'ì „ëª…ì„'},
    {team:'ë¬´í˜•ì„œë¹„ìŠ¤íŒ€', name:'ì„ë™í›ˆ'},{team:'ë¬´í˜•ì„œë¹„ìŠ¤íŒ€', name:'í•œì¬ì›…'},{team:'ë¬´í˜•ì„œë¹„ìŠ¤íŒ€', name:'ìµœì£¼í™˜'},{team:'ë¬´í˜•ì„œë¹„ìŠ¤íŒ€', name:'ë‚¨ìƒì¤€'},
    {team:'ê°ì‚¬íŒ€', name:'ì†ë¯¼ì² '},{team:'ê°ì‚¬íŒ€', name:'ì¡°íƒœìœ¤'}
  ];
  const total = validEntries.length;
  let participants = JSON.parse(localStorage.getItem('participants') || '[]');

  // âœ… ë¶€ì„œ ë¦¬ìŠ¤íŠ¸
  const teams = [...new Set(validEntries.map(v=>v.team))];
  teams.forEach(t=>$('#team').append(`<option value="${t}">${t}</option>`));

  // âœ… ë¶€ì„œ ì„ íƒ ì‹œ ì´ë¦„ ë¦¬ìŠ¤íŠ¸
  $('#team').change(function(){
    const team = $(this).val();
    $('#name').html('<option value="">ì´ë¦„</option>');
    if(!team){$('#name').prop('disabled',true);return;}
    validEntries.filter(v=>v.team===team).forEach(v=>{
      const done = participants.find(p=>p.name===v.name);
      $('#name').append(`<option value="${v.name}" ${done?'disabled':''}>${v.name}${done?' (ì™„ë£Œ)':''}</option>`);
    });
    $('#name').prop('disabled',false);
  });

  $('#name').change(()=>toggleSelect());

  function toggleSelect(){
    if($('#team').val() && $('#name').val()) $('.con_select').removeClass('disabled');
    else $('.con_select').addClass('disabled');
  }

  // âœ… ì´ˆëŠ¥ë ¥ ì„ íƒ
  $('.con_select button').click(function(){
    if($('.con_select').hasClass('disabled'))return;
    $(this).toggleClass('on');
    const cnt=$('.con_select button.on').length;
    if(cnt>5){alert('ìµœëŒ€ 5ê°œê¹Œì§€ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.');$(this).removeClass('on');}
    $('.btn_end').toggleClass('active',$('#team').val()&&$('#name').val()&&cnt===5);
  });

  // âœ… ì„ íƒ ì™„ë£Œ
  $('.btn_end').click(function(){
    if(!$(this).hasClass('active'))return;
    const team=$('#team').val(),name=$('#name').val();
    const powers=$('.con_select button.on').map((i)=>i+1).get();
    participants.push({team,name,powers});
    localStorage.setItem('participants',JSON.stringify(participants));
    $('#step1').removeClass('active');$('#step2').addClass('active');
    $('.btn_next').show();
    if(participants.length>=total) $('.btn_end2').show();
  });

  // âœ… ë‹¤ìŒ ì‚¬ëŒ í…ŒìŠ¤íŠ¸
  $('.btn_next').click(()=>{location.reload();});

  // âœ… ì´ˆê¸°í™”
  $('.btn_reset').click(()=>{localStorage.clear();location.reload();});

  // âœ… í…ŒìŠ¤íŠ¸ìš© ì„ì˜ ë°ì´í„°
  $('.btn_fakefill').click(()=>{
    participants=validEntries.map(v=>{
      const p=[];while(p.length<5){const n=Math.floor(Math.random()*9)+1;if(!p.includes(n))p.push(n);}
      return {...v,powers:p};
    });
    localStorage.setItem('participants',JSON.stringify(participants));
    $('#step1').removeClass('active');$('#step2').addClass('active');
    $('.btn_end2').show();alert(`${participants.length}ëª… ì„ì˜ ìƒì„± ì™„ë£Œ`);
  });

  // âœ… ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (ì™„ì „ ê³µí†µëŠ¥ë ¥ 100% ë³´ì¥)
  $('.btn_end2').click(()=>{
    const data = JSON.parse(localStorage.getItem('participants')||'[]');

    const getCommonPowers = group => {
      if (group.length === 0) return [];
      return group.reduce((acc, p) => acc.filter(x => p.powers.includes(x)), [...group[0].powers]);
    };

    const used = new Set();
    const groups = [];

    // --- 1ë‹¨ê³„: 1ê°œ ì´ìƒ ê³µí†µëŠ¥ë ¥ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹ ìƒì„± ---
    for (let i = 0; i < data.length; i++) {
      if (used.has(i)) continue;
      const p1 = data[i];
      let group = [p1];
      used.add(i);
      let common = [...p1.powers];

      const sorted = data.map((p2, idx) => ({
        idx,
        overlap: p1.powers.filter(x => p2.powers.includes(x)),
        score: p1.powers.filter(x => p2.powers.includes(x)).length
      })).sort((a, b) => b.score - a.score);

      for (let s of sorted) {
        if (group.length >= 7) break;
        if (used.has(s.idx) || s.score < 1) continue;
        const p2 = data[s.idx];
        const newCommon = common.filter(x => p2.powers.includes(x));
        if (newCommon.length > 0) {
          group.push(p2);
          used.add(s.idx);
          common = newCommon;
        }
      }

      groups.push(group);
    }

    // --- 2ë‹¨ê³„: ê³µí†µëŠ¥ë ¥ ì—†ëŠ” ê·¸ë£¹ ê°•ì œ ì¬ì¡°ì • ---
    let noCommon = groups.filter(g => getCommonPowers(g).length === 0);
    let okGroups = groups.filter(g => getCommonPowers(g).length > 0);

    noCommon.forEach(g=>{
      g.forEach(p=>{
        let added = false;
        for (let tg of okGroups){
          const overlap = tg[0].powers.filter(x => p.powers.includes(x));
          if (overlap.length>0 && tg.length<7){
            tg.push(p);
            added = true;
            break;
          }
        }
        if(!added) okGroups.push([p]);
      });
    });

    // --- 3ë‹¨ê³„: ì¬ê²€ì¦ í›„ë„ ê³µí†µëŠ¥ë ¥ ì—†ìœ¼ë©´ ê°•ì œ ë³‘í•© ---
    okGroups.forEach(g=>{
      let common = getCommonPowers(g);
      if(common.length===0 && okGroups.length>1){
        const target = okGroups.find(tg=>getCommonPowers(tg)[0]);
        if(target){
          g.forEach(p=>{
            const overlap = target[0].powers.filter(x => p.powers.includes(x));
            if(overlap.length>0 && target.length<7){
              target.push(p);
            }
          });
        }
      }
    });

    // --- 4ë‹¨ê³„: ê· ë“± ë¶„ë°° (6~7ëª…) ---
    const flat = okGroups.flat();
    const balanced = [];
    let idx = 0;
    for (let i = 0; i < 20; i++) {
      const sz = (i < 2) ? 7 : 6;
      balanced.push(flat.slice(idx, idx + sz));
      idx += sz;
    }

    // --- 5ë‹¨ê³„: ì—‘ì…€ ìƒì„± ---
    const exportData = [];
    balanced.forEach((g, gi) => {
      const common = getCommonPowers(g).sort((a,b)=>a-b);
      g.forEach(p => {
        const partners = g.filter(x => x.name !== p.name);
        exportData.push({
          ë¶€ì„œëª…: p.team,
          ì´ë¦„: p.name,
          ì„ íƒì´ˆëŠ¥ë ¥: p.powers.sort((a,b)=>a-b).join(','),
          ìœ ì‚¬ë„ë†’ì€ì‚¬ëŒ: partners.map(x=>x.name).join(', '),
          ì™„ì „ê°™ì€ëŠ¥ë ¥: common.length ? common.join(',') : '(ì—†ìŒ)',
          ì¡°: `${gi + 1}ì¡°`
        });
      });
    });

    const ws = XLSX.utils.json_to_sheet(exportData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "ì´ˆëŠ¥ë ¥ ì¡°í¸ì„±");
    XLSX.writeFile(wb, "ì´ˆëŠ¥ë ¥_ì¡°í¸ì„±ê²°ê³¼.xlsx");
  });
});
</script>



</body>
</html>
